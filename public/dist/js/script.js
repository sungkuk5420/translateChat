var app,chat=void 0,CHATDATABASE=void 0;function makeList(e){for(var t=["banana","apple","grape","orange"],a=0;a<t.length;a++)e.push(t[a])}function getLastFromList(e,t){e.limit(1).once("child_added",function(e){t(e.val())})}function go(){var e=new Firebase("https://chat-67329.firebaseio.com");makeList(e),getLastFromList(e,function(e){})}defaultPath="/translate",$(document).ready(function(){var e,t;e=function(e){var t;return this.text=e.text,this.message_side=e.message_side,this.draw=(t=this,function(){var e;return(e=$($(".message").clone().html())).addClass(t.message_side).find(".text").html(t.text),$("#chat-messages").append(e),setTimeout(function(){return e.addClass("appeared")},0)}),this},$(function(){"right",t=function(){var e,t=(e=$(".message_input")).val();e.val("");return function(e){var t=$.Deferred();try{textTranslate({sendText:e,checkKey:!1,autoKey:!0,resultLang:"ja",cb:function(e){t.resolve(e)}})}catch(e){t.reject(e)}return t.promise()}(t).done(function(e){return e}).fail(function(t){return e.val()}).always(function(){})},function(t,a){var s;if(""!==t.trim())return $(".message_input").val(""),s=$(".messages"),new e({text:t,message_side:a}).draw(),s.animate({scrollTop:s.prop("scrollHeight")},300)},$(".send_message").click(function(e){if(""!==$(".message_input").val())return t().then(function(e){chat.pushData(chat.userName,e.sendText)})}),$(".message_input").keyup(function(e){if(13===e.which&&""!==$(".message_input").val())return t().then(function(e){chat.pushData(chat.userName,e.sendText)})})}),(chat={defaultChat:"/public",thisChatList:void 0,userName:void 0,init:function(){chat.getDatabase(function(){CHATDATABASE.ref(chat.defaultChat).limitToLast(1).on("child_added",function(e){var t=e.val(),a=DBData.filter(function(e){return e.data.sendText===t.sendText});if(0!=a.length){var s={id:e.key.replace(/-/gi,"").replace(/_/gi,""),userName:t.userName,sendText:t.sendText,translateText:a[0].data.ja,msgType:t.userName==chat.userName?"my":"other",timeStamp:t.timeStamp};0===app._data.messages.filter(function(t){return t.id===e.key.replace(/-/gi,"").replace(/_/gi,"")}).length&&app.addItem(s)}else textTranslate({sendText:t,resultLang:"ja",autoKey:!0,cb:function(e){var a={id:e.key.replace(/-/gi,"").replace(/_/gi,""),userName:t.userName,sendText:t.sendText,translateText:e.ja,msgType:t.userName==chat.userName?"my":"other",timeStamp:t.timeStamp};0===app._data.messages.filter(function(t){return t.id===e.key.replace(/-/gi,"").replace(/_/gi,"")}).length&&app.addItem(a)}})}),chat.thisChatList.forEach(function(e,t){var a=e.data,s=DBData.filter(function(e){return e.data.sendText===a.sendText});if(0!=s.length){var i={id:e.id.replace(/-/gi,"").replace(/_/gi,""),userName:a.userName,sendText:a.sendText,translateText:s[0].data.ja,msgType:a.userName==chat.userName?"my":"other",timeStamp:a.timeStamp};0===app._data.messages.filter(function(t){return t.id===e.id.replace(/-/gi,"").replace(/_/gi,"")}).length&&app.addItem(i)}else textTranslate({sendText:a.sendText,resultLang:"ja",autoKey:!0,cb:function(t){var s={id:e.id.replace(/-/gi,"").replace(/_/gi,""),userName:a.userName,sendText:a.sendText,translateText:t.ja,msgType:a.userName==chat.userName?"my":"other",timeStamp:a.timeStamp};0===app._data.messages.filter(function(t){return t.id===e.id.replace(/-/gi,"").replace(/_/gi,"")}).length&&app.addItem(s)}})})})},getDatabase:function(e){CHATDATABASE=firebase.database();new Promise(function(e,t){CHATDATABASE.ref(chat.defaultChat).on("value",function(t){var a=t.val();chat.thisChatList=Object.keys(a).map(function(e){return{id:e,data:a[e]}}),e()})}).then(function(){e&&e()},function(e){})},pushData:function(e,t){CHATDATABASE.ref(chat.defaultChat).child("/").push({userName:e,sendText:t,timeStamp:moment().format("YYYY-MM-DD,h:mm:ss")})},scrollDown:function(){$(".chat-messages").scrollTop($(".chat-messages")[0].scrollHeight)}}).init(),app=new Vue({el:"#chatbox",data:function(){return{items:[{title:"Click Me"},{title:"Click Me"},{title:"Click Me"},{title:"Click Me 2"}],messages:[]}},methods:{addItem:function(e){this.messages.push(e),this.scrollToEnd()},scrollToEnd:function(){var e=this;setTimeout(function(){var t=e.$el.querySelector("#chat-messages");t.scrollTop=t.scrollHeight},0)}}}),document.createElement("img").src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/245657/timeline1.png",$("#searchfield").focus(function(){"Search contacts..."==$(this).val()&&$(this).val("")}),$("#searchfield").focusout(function(){""==$(this).val()&&$(this).val("Search contacts...")}),$("#sendmessage .message_input").focus(function(){"Send message..."==$(this).val()&&$(this).val("")}),$("#sendmessage .message_input").focusout(function(){""==$(this).val()&&$(this).val("Send message...")}),$(".friend").each(function(){$(this).click(function(){chat.userName="aa";var e=$(this).offset(),t=$(this).parent().parent().offset(),a=e.top-t.top,s=$(this).find("img").eq(0).clone(),i=a+12+"px";$(s).css({top:i}).addClass("floatingImg").appendTo("#chatbox"),setTimeout(function(){$("#profile p").addClass("animate"),$("#profile").addClass("animate")},100),setTimeout(function(){$("#chat-messages").addClass("animate"),$(".cx, .cy").addClass("s1"),setTimeout(function(){$(".cx, .cy").addClass("s2")},100),setTimeout(function(){$(".cx, .cy").addClass("s3")},200)},150),$(".floatingImg").animate({width:"68px",left:"50%",top:"20px","margin-left":"-34px"},200);var n=$(this).find("p strong").html(),c=$(this).find("p span").html();$("#profile p").html(n),$("#profile span").html(c),$(".message").not(".right").find("img").attr("src",$(s).attr("src")),$("#friendslist").fadeOut(),$("#chatview").fadeIn(),$("#chat-messages").css("height",$("#chatview").height()-153+"px"),$("#close").unbind("click").click(function(){$("#chat-messages, #profile, #profile p").removeClass("animate"),$(".cx, .cy").removeClass("s1 s2 s3"),$(".floatingImg").animate({width:"40px",top:i,left:"12px"},200,function(){$(".floatingImg").remove()}),setTimeout(function(){$("#chatview").fadeOut(),$("#friendslist").fadeIn()},50)})})}),function(e){var t;function a(){e("#chat-messages").css("height",e("#chatview").height()-153+"px")}e(window).resize(function(){clearTimeout(t),t=setTimeout(a,250)})}(jQuery)});
$(document).ready(function(){translateInit(function(){chat.init()})});