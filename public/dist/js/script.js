(function(){var e;e=function(e){return this.text=e.text,this.message_side=e.message_side,this.draw=function(e){return function(){var t;return(t=$($(".message_template").clone().html())).addClass(e.message_side).find(".text").html(e.text),$(".messages").append(t),setTimeout(function(){return t.addClass("appeared")},0)}}(this),this},$(function(){var t,n,a;n="right",t=function(){var e,t=(e=$(".message_input")).val();return function(e){var n=$.Deferred();try{var a=getTextData(t);void 0===a?translateAPI(e,function(t){var a=t;pushData(e,a),n.resolve({ko:e,ja:a})}):n.resolve(a.data)}catch(e){n.reject(e)}return n.promise()}(t).done(function(e){return e}).fail(function(t){return e.val()}).always(function(){})},a=function(t){var a;if(""!==t.trim())return $(".message_input").val(""),a=$(".messages"),n="left"===n?"right":"left",new e({text:t,message_side:n}).draw(),a.animate({scrollTop:a.prop("scrollHeight")},300)},$(".send_message").click(function(e){return t().then(function(e){a(e.ko+"<br>"+e.ja)})}),$(".message_input").keyup(function(e){if(13===e.which)return t().then(function(e){a(e.ko+"<br>"+e.ja)})})})}).call(this);
function getDataBase(t){DATABASE.ref().on("value",function(a){var e=a.val();DBData=Object.keys(e).map(function(t){return{id:t,data:e[t]}}),t&&t(DBData)})}function pushData(t,a){firebase.database().ref().child("/").push({ja:a,ko:t})}function allTextTranslate(){$("[data-langtext]").each(function(){var t=$(this),a=$.trim(t.text()),e=getTextData(a);if(void 0===e){var n=a;translateAPI(n,function(a){pushData(n,a),t.text(a)})}else t.text(e.data.ja)})}function translateAPI(t,a){void 0===getTextData(t)&&$.ajax({type:"GET",beforeSend:function(t){t.setRequestHeader("content-type","text/javascript")},url:"/translate",data:{text:t},dataType:"json",contentType:"application/json; charset=utf-8",success:function(t){var e=(t=JSON.parse(t)).message.result.translatedText;t.message.result.srcLangType;a&&a(e)}})}function getTextData(t){var a=DBData.filter(function(a){return a.data.ko===t});return 0===a.length&&(a=DBData.filter(function(a){return a.data.ja===t})),0!==a.length?a[0]:void 0}function translateInit(){getDataBase(function(){})}var DBData=void 0,config={apiKey:"AIzaSyDApewjUdAfz8duov7fUg4Qxz4rBcPwDA8",authDomain:"chat-67329.firebaseapp.com",databaseURL:"https://chat-67329.firebaseio.com",projectId:"chat-67329",storageBucket:"",messagingSenderId:"29394740351"};firebase.initializeApp(config),DATABASE=firebase.database();
$(document).ready(function(){translateInit()});